
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>GeoBench Visualization</title>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
        <link rel="stylesheet" href="style.css" id="theme-css">
    </head>
    <body>
        <div id="container">
            <div id="header">
                <div id="filters">
                    <div class="filter-group">
                        <label for="dataset-filter">Test Dataset: </label>
                        <select id="dataset-filter"></select>
                    </div>
                    <div class="filter-group">
                        <label for="location-selector">Location: </label>
                        <select id="location-selector"></select>
                    </div>
                </div>
                <div id="location-info"></div>
            </div>
            <div id="map">
                <div id="legend"></div>
            </div>
            <div id="no-data-message">
                No data available for the selected dataset. Please choose a different dataset.
            </div>
            <div id="navigation">
                <button class="nav-button" id="prev-button">← Previous</button>
                <span id="location-counter"></span>
                <button class="nav-button" id="next-button">Next →</button>
            </div>
            <div id="info-panel">
                <div id="model-comparisons"></div>
            </div>
        </div>
        
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
        <script>
            // Data from Python
            const locationData = {"40.32681,-86.39295": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "1", "country_true": "United States of America (the)", "lat_true": "40.32681184498625", "lng_true": "-86.39295097307378", "refused": "False", "error_message": "", "country_guess": "USA", "lat_guess": "40.65", "lng_guess": "-89.5", "distance_km": "265.1881867380001", "score": "4333", "country_correct": "True", "test_dataset": "5Flash"}}, "-1.3526,37.99741": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "2", "country_true": "Kenya", "lat_true": "-1.352601743911717", "lng_true": "37.99741452703736", "refused": "False", "error_message": "", "country_guess": "Kenya", "lat_guess": "-1.28", "lng_guess": "36.82", "distance_km": "131.13668979414257", "score": "4658", "country_correct": "True", "test_dataset": "5Flash"}}, "6.13647,116.14766": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "3", "country_true": "Malaysia", "lat_true": "6.136473583302893", "lng_true": "116.1476628891291", "refused": "False", "error_message": "", "country_guess": "Philippines", "lat_guess": "12.5", "lng_guess": "124.0", "distance_km": "1114.547671454052", "score": "2740", "country_correct": "False", "test_dataset": "5Flash"}}, "15.9899,120.96818": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "4", "country_true": "Philippines (the)", "lat_true": "15.98989766306146", "lng_true": "120.968183959072", "refused": "False", "error_message": "", "country_guess": "Philippines", "lat_guess": "14.7", "lng_guess": "121.1", "distance_km": "144.1248325834459", "score": "4626", "country_correct": "True", "test_dataset": "5Flash"}}, "17.55974,121.35126": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "5", "country_true": "Philippines (the)", "lat_true": "17.55974442027697", "lng_true": "121.3512588621069", "refused": "False", "error_message": "", "country_guess": "Philippines", "lat_guess": "16.0", "lng_guess": "120.0", "distance_km": "225.32782365962402", "score": "4428", "country_correct": "True", "test_dataset": "5Flash"}}, "42.32271,-3.19609": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "6", "country_true": "Spain", "lat_true": "42.32271216378171", "lng_true": "-3.19608874237189", "refused": "False", "error_message": "", "country_guess": "Spain", "lat_guess": "42.8", "lng_guess": "-2.5", "distance_km": "77.88923671691828", "score": "4794", "country_correct": "True", "test_dataset": "5Flash"}}, "41.57266,42.80834": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "7", "country_true": "Turkiye", "lat_true": "41.572658908454144", "lng_true": "42.808340055946594", "refused": "False", "error_message": "", "country_guess": "Turkey", "lat_guess": "41.2", "lng_guess": "32.8", "distance_km": "835.5152410343559", "score": "3186", "country_correct": "True", "test_dataset": "5Flash"}}, "56.37213,8.12096": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "8", "country_true": "Denmark", "lat_true": "56.37212534487771", "lng_true": "8.12095854369117", "refused": "False", "error_message": "", "country_guess": "Denmark", "lat_guess": "55.67", "lng_guess": "12.57", "distance_km": "287.2408135683866", "score": "4282", "country_correct": "True", "test_dataset": "5Flash"}}, "14.00594,100.21524": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "9", "country_true": "Thailand", "lat_true": "14.00593663473394", "lng_true": "100.2152414040161", "refused": "False", "error_message": "", "country_guess": "Thailand", "lat_guess": "14.8", "lng_guess": "101.0", "distance_km": "122.22682966247396", "score": "4681", "country_correct": "True", "test_dataset": "5Flash"}}, "-28.65328,21.77171": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "10", "country_true": "South Africa", "lat_true": "-28.65328386761398", "lng_true": "21.77170652448631", "refused": "False", "error_message": "", "country_guess": "South Africa", "lat_guess": "-28.5", "lng_guess": "24.0", "distance_km": "218.25379777528605", "score": "4445", "country_correct": "True", "test_dataset": "5Flash"}}, "14.8042,-15.96335": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "11", "country_true": "Senegal", "lat_true": "14.804201177326616", "lng_true": "-15.963350246959369", "refused": "False", "error_message": "", "country_guess": "Senegal", "lat_guess": "14.7", "lng_guess": "-17.4", "distance_km": "154.91594185162785", "score": "4599", "country_correct": "True", "test_dataset": "5Flash"}}, "45.41279,3.72411": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "12", "country_true": "France", "lat_true": "45.41278777073028", "lng_true": "3.724108146130144", "refused": "False", "error_message": "", "country_guess": "France", "lat_guess": "45.0", "lng_guess": "5.0", "distance_km": "109.99020551974607", "score": "4712", "country_correct": "True", "test_dataset": "5Flash"}}, "17.41401,102.6829": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "13", "country_true": "Thailand", "lat_true": "17.41401324107727", "lng_true": "102.682895875028", "refused": "False", "error_message": "", "country_guess": "Thailand", "lat_guess": "13.75", "lng_guess": "100.5", "distance_km": "469.7154311374889", "score": "3881", "country_correct": "True", "test_dataset": "5Flash"}}, "39.00444,-87.90899": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "14", "country_true": "United States of America (the)", "lat_true": "39.00444219781861", "lng_true": "-87.90898943056413", "refused": "False", "error_message": "", "country_guess": "United States", "lat_guess": "41.75", "lng_guess": "-87.65", "distance_km": "306.0788591615247", "score": "4239", "country_correct": "True", "test_dataset": "5Flash"}}, "25.90987,56.05753": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "15", "country_true": "United Arab Emirates (the)", "lat_true": "25.90987397358494", "lng_true": "56.05753065165039", "refused": "False", "error_message": "", "country_guess": "United Arab Emirates", "lat_guess": "24.4667", "lng_guess": "54.3667", "distance_km": "233.86878982521446", "score": "4407", "country_correct": "True", "test_dataset": "5Flash"}}, "28.28898,129.44249": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "16", "country_true": "Japan", "lat_true": "28.28898129095336", "lng_true": "129.4424876157621", "refused": "False", "error_message": "", "country_guess": "Japan", "lat_guess": "26.25", "lng_guess": "128.25", "distance_km": "255.52415331181643", "score": "4356", "country_correct": "True", "test_dataset": "5Flash"}}, "33.40571,10.85802": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "17", "country_true": "Tunisia", "lat_true": "33.40570884427695", "lng_true": "10.85801771087834", "refused": "False", "error_message": "", "country_guess": "Tunisia", "lat_guess": "34.5", "lng_guess": "9.5", "distance_km": "174.6257170026296", "score": "4550", "country_correct": "True", "test_dataset": "5Flash"}}, "-15.87767,-52.31442": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "18", "country_true": "Brazil", "lat_true": "-15.87766882502537", "lng_true": "-52.31441884141353", "refused": "False", "error_message": "", "country_guess": "Brazil", "lat_guess": "-19.95", "lng_guess": "-44.0", "distance_km": "989.1230707048038", "score": "2932", "country_correct": "True", "test_dataset": "5Flash"}}, "-2.56422,-44.36201": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "19", "country_true": "Brazil", "lat_true": "-2.564223758603879", "lng_true": "-44.36201316849923", "refused": "False", "error_message": "", "country_guess": "Brazil", "lat_guess": "-23.5", "lng_guess": "-46.5", "distance_km": "2339.2966353493525", "score": "1415", "country_correct": "True", "test_dataset": "5Flash"}}, "1.8514,103.07169": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "20", "country_true": "Malaysia", "lat_true": "1.851401998733905", "lng_true": "103.0716921676924", "refused": "False", "error_message": "", "country_guess": "Malaysia", "lat_guess": "5.35", "lng_guess": "100.35", "distance_km": "492.4850007211294", "score": "3833", "country_correct": "True", "test_dataset": "5Flash"}}, "22.73753,87.47362": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "21", "country_true": "India", "lat_true": "22.73752550181129", "lng_true": "87.47361896647585", "refused": "False", "error_message": "", "country_guess": "India", "lat_guess": "22.0", "lng_guess": "82.0", "distance_km": "568.7475418699943", "score": "3679", "country_correct": "True", "test_dataset": "5Flash"}}, "51.65803,39.1849": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "22", "country_true": "Russian Federation (the)", "lat_true": "51.65803098800835", "lng_true": "39.18490442294509", "refused": "False", "error_message": "", "country_guess": "Russia", "lat_guess": "51.7", "lng_guess": "39.2", "distance_km": "4.781397901545476", "score": "4987", "country_correct": "True", "test_dataset": "5Flash"}}, "32.55864,35.17181": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "23", "country_true": "Israel", "lat_true": "32.55864227389826", "lng_true": "35.171809058031485", "refused": "False", "error_message": "", "country_guess": "Israel", "lat_guess": "31.7", "lng_guess": "35.0", "distance_km": "96.83762513684721", "score": "4745", "country_correct": "True", "test_dataset": "5Flash"}}, "16.59231,99.70317": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "24", "country_true": "Thailand", "lat_true": "16.59230592277572", "lng_true": "99.70317028994693", "refused": "False", "error_message": "", "country_guess": "Thailand", "lat_guess": "15.0", "lng_guess": "101.0", "distance_km": "224.94530289302878", "score": "4429", "country_correct": "True", "test_dataset": "5Flash"}}, "40.87122,21.93142": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "25", "country_true": "Greece", "lat_true": "40.87121929854031", "lng_true": "21.931419707394998", "refused": "False", "error_message": "", "country_guess": "Albania", "lat_guess": "41.0", "lng_guess": "19.8", "distance_km": "179.6102960580512", "score": "4538", "country_correct": "False", "test_dataset": "5Flash"}}, "1.02846,121.65622": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "26", "country_true": "Indonesia", "lat_true": "1.028458653635989", "lng_true": "121.6562215589341", "refused": "False", "error_message": "", "country_guess": "Malaysia", "lat_guess": "5.5", "lng_guess": "101.5", "distance_km": "2291.6111591396757", "score": "1452", "country_correct": "False", "test_dataset": "5Flash"}}, "48.58768,28.671": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "27", "country_true": "Ukraine", "lat_true": "48.58767856586696", "lng_true": "28.67100448071756", "refused": "False", "error_message": "", "country_guess": "Ukraine", "lat_guess": "48.8", "lng_guess": "27.5", "distance_km": "89.1317129779429", "score": "4765", "country_correct": "True", "test_dataset": "5Flash"}}, "45.14623,7.0419": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "28", "country_true": "Italy", "lat_true": "45.14622759605658", "lng_true": "7.041899249181", "refused": "False", "error_message": "", "country_guess": "Italy", "lat_guess": "44.45", "lng_guess": "7.8", "distance_km": "97.83258579751491", "score": "4743", "country_correct": "True", "test_dataset": "5Flash"}}, "24.14781,89.26599": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "29", "country_true": "Bangladesh", "lat_true": "24.14781012004505", "lng_true": "89.26598582558208", "refused": "False", "error_message": "", "country_guess": "Bangladesh", "lat_guess": "23.8", "lng_guess": "90.4", "distance_km": "121.53544467287924", "score": "4683", "country_correct": "True", "test_dataset": "5Flash"}, "Llama90bVision_acw-02-25-25_2025-03-22T08_47_36": {"location_id": "29", "country_true": "Bangladesh", "lat_true": "24.14781012004505", "lng_true": "89.26598582558208", "refused": "False", "error_message": "", "country_guess": "Bangladesh", "lat_guess": "23.81", "lng_guess": "90.35", "distance_km": "116.36294515836559", "score": "4696.0", "country_correct": "True", "test_dataset": "acw-02-25-25"}}, "1.80376,-77.27059": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "30", "country_true": "Colombia", "lat_true": "1.803756625965408", "lng_true": "-77.27058972986394", "refused": "False", "error_message": "", "country_guess": "Honduras", "lat_guess": "14.5", "lng_guess": "-87.0", "distance_km": "1770.566383499065", "score": "1924", "country_correct": "False", "test_dataset": "5Flash"}}, "38.22334,21.73622": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"location_id": "31", "country_true": "Greece", "lat_true": "38.22334474631216", "lng_true": "21.73621881038419", "refused": "False", "error_message": "", "country_guess": "Greece", "lat_guess": "37.95", "lng_guess": "23.75", "distance_km": "178.8421977364351", "score": "4540", "country_correct": "True", "test_dataset": "5Flash"}}, "0.70959,122.42551": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_59_18": {"location_id": "83", "country_true": "Indonesia", "lat_true": "0.7095930967561827", "lng_true": "122.42550577096512", "refused": "False", "error_message": "", "country_guess": "Indonesia", "lat_guess": "-2.0", "lng_guess": "102.0", "distance_km": "2290.7583661462254", "score": "1453", "country_correct": "True", "test_dataset": "5Flash"}}, "55.37283,11.44857": {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_59_18": {"location_id": "78", "country_true": "Denmark", "lat_true": "55.37282666529563", "lng_true": "11.44857012104011", "refused": "False", "error_message": "", "country_guess": "Denmark", "lat_guess": "55.8", "lng_guess": "10.5", "distance_km": "76.22032227169353", "score": "4799", "country_correct": "True", "test_dataset": "5Flash"}}};
            const modelNames = ["Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44", "Gemini1_5Flash_acw-02-25-25_2025-03-22T08_59_18", "Llama90bVision_acw-02-25-25_2025-03-22T08_47_36"];
            const modelMetadata = {"Gemini1_5Flash_acw-02-25-25_2025-03-22T08_43_44": {"company": "Google", "color": "#4285F4", "test_dataset": "5Flash", "display_name": "Gemini1_5Flash"}, "Gemini1_5Flash_acw-02-25-25_2025-03-22T08_59_18": {"company": "Google", "color": "#4285F4", "test_dataset": "5Flash", "display_name": "Gemini1_5Flash"}, "Llama90bVision_acw-02-25-25_2025-03-22T08_47_36": {"company": "Meta", "color": "#add4ed", "test_dataset": "acw-02-25-25", "display_name": "Llama90bVision"}};
            const testDatasets = ["5Flash", "acw-02-25-25"];
            
            // State variables
            let currentLocationIndex = 0;
            let filteredLocationKeys = [];
            let map = null;
            let trueMarker = null;
            let guessMarkers = [];
            let connectionLines = [];
            let currentDataset = 'all'; 
            
            // Initialize the visualization
            function init() {
                // Setup map
                map = L.map('map', {attributionControl: false}).setView([0, 0], 2);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                    maxZoom: 19
                }).addTo(map);
                
                // Create legend
                createLegend();
                
                // Populate dataset filter
                populateDatasetFilter();
                
                // Apply initial filtering
                applyDatasetFilter();
                
                // Event listeners
                document.getElementById('dataset-filter').addEventListener('change', (e) => {
                    currentDataset = e.target.value;
                    currentLocationIndex = 0;
                    applyDatasetFilter();
                });
                
                document.getElementById('location-selector').addEventListener('change', (e) => {
                    const selectedIndex = filteredLocationKeys.indexOf(e.target.value);
                    if (selectedIndex !== -1) {
                        currentLocationIndex = selectedIndex;
                        showLocation(e.target.value);
                    }
                });
                
                document.getElementById('prev-button').addEventListener('click', () => {
                    if (currentLocationIndex > 0) {
                        currentLocationIndex--;
                        showLocation(filteredLocationKeys[currentLocationIndex]);
                    }
                });
                
                document.getElementById('next-button').addEventListener('click', () => {
                    if (currentLocationIndex < filteredLocationKeys.length - 1) {
                        currentLocationIndex++;
                        showLocation(filteredLocationKeys[currentLocationIndex]);
                    }
                });
                
                // Keyboard navigation with arrow keys
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'ArrowLeft') {
                        if (currentLocationIndex > 0) {
                            currentLocationIndex--;
                            showLocation(filteredLocationKeys[currentLocationIndex]);
                        }
                    } else if (e.key === 'ArrowRight') {
                        if (currentLocationIndex < filteredLocationKeys.length - 1) {
                            currentLocationIndex++;
                            showLocation(filteredLocationKeys[currentLocationIndex]);
                        }
                    }
                });
            }
            
            function createLegend() {
                const legend = document.getElementById('legend');
                legend.innerHTML = '<h4 style="margin-top: 0; margin-bottom: 10px;">Legend</h4>';
                
                // Add true location to legend
                const trueLegendItem = document.createElement('div');
                trueLegendItem.className = 'legend-item';
                trueLegendItem.innerHTML = `
                    <span class="color-box" style="background-color: green;"></span>
                    <span>Location</span>
                `;
                legend.appendChild(trueLegendItem);
                
                // Group models by company and display name to avoid duplicates
                const companiesModels = {};
                const displayedModels = new Set(); // Track which display names we've already shown
                
                // First pass - group by company
                modelNames.forEach(model => {
                    const company = modelMetadata[model].company;
                    if (!companiesModels[company]) {
                        companiesModels[company] = [];
                    }
                    
                    // Get display name
                    const displayName = modelMetadata[model].display_name || model;
                    
                    // Create a unique key for this display name to avoid duplicates
                    const displayKey = `${company}_${displayName}`;
                    
                    // Only add if we haven't already added this display name
                    if (!displayedModels.has(displayKey)) {
                        displayedModels.add(displayKey);
                        companiesModels[company].push({
                            dirName: model,
                            displayName: displayName
                        });
                    }
                });
                
                // Add companies and their models to legend
                Object.keys(companiesModels).sort().forEach(company => {
                    // Skip if the company has no models after deduplication
                    if (companiesModels[company].length === 0) return;
                    
                    // Company header
                    const companySection = document.createElement('div');
                    companySection.className = 'company-section';
                    
                    const companyHeader = document.createElement('div');
                    companyHeader.className = 'company-header';
                    companyHeader.textContent = company;
                    companySection.appendChild(companyHeader);
                    
                    // Add models for this company
                    companiesModels[company].forEach(modelInfo => {
                        const modelItem = document.createElement('div');
                        modelItem.className = 'legend-item';
                        
                        modelItem.innerHTML = `
                            <span class="color-box" style="background-color: ${modelMetadata[modelInfo.dirName].color};"></span>
                            <span>${modelInfo.displayName}</span>
                        `;
                        companySection.appendChild(modelItem);
                    });
                    
                    legend.appendChild(companySection);
                });
            }
            
            function populateDatasetFilter() {
                const datasetFilter = document.getElementById('dataset-filter');
                
                // Add 'All' option
                const allOption = document.createElement('option');
                allOption.value = 'all';
                allOption.textContent = 'All Datasets';
                datasetFilter.appendChild(allOption);
                
                // Add dataset options
                testDatasets.sort().forEach(dataset => {
                    const option = document.createElement('option');
                    option.value = dataset;
                    option.textContent = dataset;
                    datasetFilter.appendChild(option);
                });
            }
            
            function applyDatasetFilter() {
                // Filter locations based on dataset
                filteredLocationKeys = Object.keys(locationData).filter(locationKey => {
                    if (currentDataset === 'all') return true;
                    
                    // Check if this location has data from the selected dataset
                    const modelsData = locationData[locationKey];
                    return Object.values(modelsData).some(modelData => 
                        modelData.test_dataset === currentDataset
                    );
                });
                
                // Re-populate location selector
                populateLocationSelector();
                
                // Show message if no data available
                const noDataMessage = document.getElementById('no-data-message');
                const navigationDiv = document.getElementById('navigation');
                const infoPanel = document.getElementById('info-panel');
                const mapDiv = document.getElementById('map');
                
                if (filteredLocationKeys.length === 0) {
                    noDataMessage.style.display = 'block';
                    navigationDiv.style.display = 'none';
                    infoPanel.style.display = 'none';
                    mapDiv.style.opacity = '0.3';
                } else {
                    noDataMessage.style.display = 'none';
                    navigationDiv.style.display = 'flex';
                    infoPanel.style.display = 'block';
                    mapDiv.style.opacity = '1';
                    
                    // Show first location
                    currentLocationIndex = 0;
                    showLocation(filteredLocationKeys[0]);
                }
            }
            
            function populateLocationSelector() {
                const locationSelector = document.getElementById('location-selector');
                locationSelector.innerHTML = ''; // Clear existing options
                
                filteredLocationKeys.forEach((locationKey, index) => {
                    const option = document.createElement('option');
                    option.value = locationKey;
                    
                    // Get country from any model's data
                    const modelsData = locationData[locationKey];
                    const firstModelData = modelsData[Object.keys(modelsData)[0]];
                    const country = firstModelData.country_true;
                    
                    option.textContent = `${index + 1}: ${country} (${locationKey})`;
                    locationSelector.appendChild(option);
                });
            }
            
            function showLocation(locationKey) {
                // Update selector
                document.getElementById('location-selector').value = locationKey;
                
                // Update location counter
                document.getElementById('location-counter').textContent = 
                    `Location ${currentLocationIndex + 1} of ${filteredLocationKeys.length}`;
                
                // Clear previous markers and lines
                if (trueMarker) map.removeLayer(trueMarker);
                guessMarkers.forEach(marker => map.removeLayer(marker));
                connectionLines.forEach(line => map.removeLayer(line));
                guessMarkers = [];
                connectionLines = [];
                
                // Get location coordinates
                const [trueLat, trueLng] = locationKey.split(',').map(parseFloat);
                
                // Get all model data for this location
                const modelsData = locationData[locationKey];
                const firstModelData = modelsData[Object.keys(modelsData)[0]];
                
                // Update location info
                document.getElementById('location-info').textContent = 
                    `${firstModelData.country_true} (${trueLat.toFixed(4)}, ${trueLng.toFixed(4)})`;
                
                // Add true location marker
                trueMarker = L.marker([trueLat, trueLng], {
                    icon: L.icon({
                        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
                        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
                        iconSize: [25, 41],
                        iconAnchor: [12, 41],
                        popupAnchor: [1, -34],
                        shadowSize: [41, 41]
                    })
                }).addTo(map).bindPopup(firstModelData.country_true);
                
                // Clear model comparisons panel
                const modelComparisons = document.getElementById('model-comparisons');
                modelComparisons.innerHTML = '';
                
                // Bounds for map view
                const points = [[trueLat, trueLng]];
                
                // Filter models by dataset if needed
                const filteredModels = modelNames.filter(model => {
                    if (currentDataset === 'all') return true;
                    if (!modelsData[model]) return false;
                    return modelsData[model].test_dataset === currentDataset;
                });
                
                // Process each model's guess
                filteredModels.forEach(model => {
                    if (modelsData[model]) {
                        const modelData = modelsData[model];
                        
                        // Skip models from different datasets if filtering
                        if (currentDataset !== 'all' && modelData.test_dataset !== currentDataset) {
                            return;
                        }
                        
                        // Add model comparison details
                        addModelComparisonDetails(model, modelData);
                        
                        // Only add guess marker and line if there was a valid guess
                        if (modelData.lat_guess && modelData.lng_guess && modelData.refused !== 'True') {
                            const guessLat = parseFloat(modelData.lat_guess);
                            const guessLng = parseFloat(modelData.lng_guess);
                            
                            // Add point to bounds
                            points.push([guessLat, guessLng]);
                            
                            // Get color from metadata
                            const modelColor = modelMetadata[model].color;
                            
                            // Create custom icon with model color
                            const customIcon = L.divIcon({
                                html: `<div style="background-color: ${modelColor}; width: 15px; height: 15px; border-radius: 50%; border: 2px solid white;"></div>`,
                                className: 'custom-marker',
                                iconSize: [25, 25],
                                iconAnchor: [8, 8]
                            });
                            
                            // Add marker
                            const marker = L.marker([guessLat, guessLng], { icon: customIcon })
                                .addTo(map)
                                .bindPopup(`${modelMetadata[model].display_name}`);
                            guessMarkers.push(marker);
                            
                            // Add line connecting true location and guess
                            const line = L.polyline([[trueLat, trueLng], [guessLat, guessLng]], {
                                color: modelColor,
                                dashArray: '5, 10',
                                weight: 2,
                                opacity: 0.7
                            }).addTo(map);
                            connectionLines.push(line);
                        }
                    }
                });
                
                // Fit map to show all points
                if (points.length > 1) {
                    const bounds = L.latLngBounds(points);
                    map.fitBounds(bounds, { padding: [50, 50] });
                } else {
                    // If only true location, zoom to it
                    map.setView([trueLat, trueLng], 5);
                }
            }
            
            function addModelComparisonDetails(model, modelData) {
                const modelComparisons = document.getElementById('model-comparisons');
                
                const modelDiv = document.createElement('div');
                modelDiv.className = 'model-details';
                
                const isCorrectCountry = modelData.country_correct === 'True';
                const distance = parseFloat(modelData.distance_km);
                const score = parseInt(modelData.score);
                
                // Use the display name from metadata if available
                const displayName = modelMetadata[model].display_name || model;
                
                modelDiv.innerHTML = `
                    <div class="model-header">
                        <span class="model-color" style="background-color: ${modelMetadata[model].color};"></span>
                        <span>${displayName}</span>
                        <span class="stats-summary">
                            Dataset: ${modelData.test_dataset} | 
                            Company: ${modelMetadata[model].company}
                        </span>
                    </div>
                    <div>
                        <p>Guessed: ${modelData.country_guess || 'No guess'} 
                        (${modelData.lat_guess || 'N/A'}, ${modelData.lng_guess || 'N/A'})</p>
                        <p>Distance: ${distance.toFixed(2)} km | Score: ${score.toLocaleString()}</p>
                        <p class="${isCorrectCountry ? 'correct' : 'incorrect'}">
                            Correct country: ${isCorrectCountry ? 'Yes ✓' : 'No ✗'}
                        </p>
                        ${modelData.refused === 'True' ? '<p><strong>Note:</strong> Model refused to guess</p>' : ''}
                        ${modelData.error_message ? `<p><strong>Error:</strong> ${modelData.error_message}</p>` : ''}
                    </div>
                `;
                
                modelComparisons.appendChild(modelDiv);
            }
            
            // Initialize on page load
            window.onload = init;
        </script>
    </body>
    </html>
    